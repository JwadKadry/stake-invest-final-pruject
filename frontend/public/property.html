<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stake • פרטי נכס</title>
  <link rel="stylesheet" href="./css/styles.css" />
  <link rel="stylesheet" href="./css/property.css" />
</head>
<body>
  <div class="details-wrap">
    <div class="details-top">
      <div class="property-actions" style="display:flex;gap:8px;align-items:center">
        <button class="back-link" id="backBtn">⬅️ חזרה</button>
        <button class="back-link" id="homeBtn" style="padding:8px 16px;background:#f3f4f6;border:1px solid #d1d5db;border-radius:8px;cursor:pointer">🏠 דף הבית</button>
      </div>
      <h1 style="margin:0">פרטי נכס</h1>
      <div></div>
    </div>

    <div id="error" style="display:none;color:#b91c1c;margin:10px 0"></div>

    <div class="details-grid">
      <div class="panel">
        <img id="heroImg" class="hero-img" alt="תמונת נכס" />
        <div class="panel-body">
          <h2 id="title" class="title"></h2>
          <p id="subtitle" class="sub"></p>
          <p id="desc" style="margin:12px 0 0;line-height:1.6"></p>
        </div>
      </div>

      <div class="panel">
        <div class="panel-body">
          <div class="kpis">
            <div class="kpi"><small>עיר</small><div id="city">—</div></div>
            <div class="kpi"><small>סוג</small><div id="type">—</div></div>
            <div class="kpi" id="bedsRow"><small>חדרים</small><div id="bedrooms">—</div></div>
            <div class="kpi" id="bathsRow"><small>חדרי רחצה</small><div id="bathrooms">—</div></div>
            <div class="kpi" id="areaRow"><small>שטח</small><div id="area">—</div></div>
            <div class="kpi"><small>שנת בנייה</small><div id="yearBuilt">—</div></div>
            <div class="kpi"><small>מחיר</small><div id="price">—</div></div>
          </div>
          
          <!-- Building notice for Multi-Unit properties -->
          <div id="buildingNotice" class="building-notice" style="display:none">
            <span class="notice-icon">🏢</span>
            <span>נכס ברמת בניין (מספר יחידות)</span>
          </div>

          <div class="actions">
            <button class="primary" id="investBtn" type="button">השקע עכשיו</button>
            <button class="ghost" id="shareBtn">שתף</button>
            <button class="ghost" id="favoriteBtn" type="button" title="הוסף למועדפים" style="font-size:20px;padding:8px 12px">★</button>
          </div>

          <p class="invest-disclaimer">
            ההשקעה מתבצעת כחלק מקבוצת משקיעים.<br>
            הנתונים המוצגים הם הערכות ואינם התחייבות לתשואה.
          </p>
        </div>
      </div>

      <div class="panel" style="margin-top:14px">
        <div class="panel-body">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
            <div class="muted">התקדמות מימון</div>
            <div id="fundedText" style="font-weight:700">0%</div>
          </div>

          <div style="height:10px;background:#eef2f7;border-radius:999px;overflow:hidden;margin-top:10px">
            <div id="fundedBar" style="height:100%;width:0%;background:#22c55e"></div>
          </div>

          <div class="muted" id="fundedMeta" style="margin-top:8px">
            0 ₪ מתוך 0 ₪
          </div>

          <div class="remaining-invest" style="margin-top:12px;padding-top:12px;border-top:1px solid #eef2f7">
            <div style="color:#6b7280;font-size:13px;margin-bottom:4px">נותרו להשקעה עד 100%:</div>
            <strong id="remainingAmount" style="font-size:16px;color:#059669">0 ₪</strong>
          </div>
        </div>
      </div>
      
      <!-- How Investment Works -->
      <div class="panel invest-explain" style="margin-top:14px">
        <div class="panel-body">
          <h3 style="margin:0 0 14px">איך ההשקעה בנכס הזה עובדת?</h3>
          <p class="explain-text">
            הנכס נרכש על ידי קבוצת משקיעים.<br>
            כל משקיע מקבל חלק יחסי בבעלות על הנכס בהתאם לסכום שהשקיע.<br>
            הנכס מושכר, וההכנסות מחולקות בין המשקיעים באופן יחסי.
          </p>
          
          <h4 style="margin:18px 0 12px;color:var(--text)">📊 דוגמה לחלוקת רווחים</h4>
          <div class="example-grid">
            <div class="example-item"><small>מחיר הנכס</small><div>1,200,000 ₪</div></div>
            <div class="example-item"><small>סך כל המשקיעים</small><div>120</div></div>
            <div class="example-item"><small>סכום ההשקעה שלך</small><div>10,000 ₪</div></div>
            <div class="example-item"><small>החלק שלך בנכס</small><div>0.83%</div></div>
            <div class="example-item"><small>הכנסה חודשית משכירות</small><div>6,000 ₪</div></div>
            <div class="example-item highlight"><small>ההכנסה החודשית שלך</small><div>≈ 50 ₪</div></div>
          </div>
          <p class="explain-note">💡 ההכנסה מחולקת לפי אחוז ההשקעה – בלי קשר למספר המשקיעים.</p>
        </div>
      </div>
      
      <!-- Investment Strategy -->
      <div class="panel" style="margin-top:14px">
        <div class="panel-body">
          <h3 style="margin:0 0 14px">אסטרטגיית ההשקעה</h3>
          <div class="strategy-grid">
            <div class="strategy-item">
              <span class="strategy-icon">🟢</span>
              <div>
                <strong>Income (הכנסה שוטפת)</strong>
                <p>הכנסה חודשית משכירות לאורך זמן.</p>
              </div>
            </div>
            <div class="strategy-item">
              <span class="strategy-icon">🔵</span>
              <div>
                <strong>Capital Growth (עליית ערך)</strong>
                <p>רווח ממכירת הנכס בעתיד במחיר גבוה יותר.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <section class="panel" style="margin-top:14px">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
        <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap">
          <h3 style="margin:0">ההשקעות שלי בנכס</h3>
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
            <input type="checkbox" id="showCanceled" />
            <span class="muted">הצג גם מבוטלות</span>
          </label>
        </div>
        <div class="muted" id="invMeta">—</div>
      </div>

      <div style="overflow:auto;margin-top:10px">
        <table style="width:100%;border-collapse:separate;border-spacing:0 8px">
          <thead class="muted" style="text-align:right">
            <tr>
              <th style="padding:6px 10px">תאריך</th>
              <th style="padding:6px 10px">סכום</th>
              <th style="padding:6px 10px">עמלה</th>
              <th style="padding:6px 10px">סה״כ</th>
              <th style="padding:6px 10px">אמצעי</th>
              <th style="padding:6px 10px">סטטוס</th>
              <th style="padding:6px 10px">פעולות</th>
            </tr>
          </thead>
          <tbody id="invRows"></tbody>
        </table>
      </div>

      <div id="invEmpty" class="muted" style="margin-top:10px;display:none">
        אין עדיין השקעות בנכס הזה.
      </div>
    </section>
  </div>

  <dialog id="investModal" class="stake-modal">
    <form method="dialog" class="modal-card" id="investForm">
      <div class="modal-head">
        <div>
          <div class="modal-title">השקעה בנכס</div>
          <div class="modal-sub" id="investPropName">—</div>
        </div>
        <button id="investmentModalClose" type="button" class="icon-x" value="cancel" aria-label="סגירה">✕</button>
      </div>

      <div class="modal-body">
        <label class="field">
          <span>סכום השקעה (₪)</span>
          <input id="investAmount" type="number" inputmode="numeric" min="2000" step="1" placeholder="הכנס סכום: 2000" required />
          <small>מינימום ₪2,000 · צעדים של ₪50 (דמו) · ניתן לסגור נכס גם אם לא כפולה של 50</small>
        </label>

        <label class="field" style="margin-top:10px">
          <span>בחר סכום (Slider)</span>
          <input id="investRange" type="range" min="2000" max="2000000" step="1" value="2000" />
          <small id="rangeHint">₪1,000</small>
        </label>

        <div id="investError" style="display:none;color:#b91c1c;margin-top:10px;font-size:13px"></div>

        <div class="calc-grid">
          <div class="calc-item">
            <small>עמלת שירות (1%)</small>
            <div id="feeText">₪0</div>
          </div>
          <div class="calc-item">
            <small>סה״כ לתשלום</small>
            <div id="totalText">₪0</div>
          </div>
          <div class="calc-item">
            <small>יחידות דמו</small>
            <div id="unitsText">0</div>
          </div>
          <div class="calc-item">
            <small>אחוז בעלות דמו</small>
            <div id="pctText">0%</div>
          </div>
        </div>

        <div class="disclaimer">
          *זהו מודאל דמו (Stake-style). אין ביצוע תשלום אמיתי.
        </div>
      </div>

      <div class="modal-foot">
        <button id="investmentCancelBtn" type="button" class="ghost" value="cancel">ביטול</button>
        <button class="primary" id="confirmInvestBtn" value="default">אישור השקעה</button>
      </div>
    </form>
  </dialog>

  <script type="module">
    // ✅ Sync auth state from server (not localStorage)
    import { updateAuthNav } from "./js/auth-ui.js";
    await updateAuthNav();
  </script>
  <script type="module" src="./js/property.js"></script>
</body>
</html>
